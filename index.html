<!DOCTYPE html>
<html lang="en">
 <head>   
    <meta charset	="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="minimal-ui, width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta name		="description" content="">
    <meta name		="author" content="Xing Yu">

	<meta name="application-name" content="NG BUSES">
	<meta name="apple-mobile-web-app-title" content="Xing Yu">
	<link rel="apple-touch-icon" href="nxy.png">
<link rel="apple-touch-startup-image" href="nxy.png">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="mobile-web-app-capable" content="yes">
	<title>Xing Yu</title>
<meta http-equiv="Expires" content="60000" />
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css"> 
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script> 
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css"> 

<script>
$(document).ready(function(){

    $("#BusStopNumber").on('change', function(){

var bus, x = '';
var i= 0;
var d = new Date();
id=$('#BusStopNumber').val();

x+= id.concat('hi again, xd');
$("#stage").append(x);
var url= "http://datamall2.mytransport.sg/ltaodataservice/BusArrival?BusStopID=".concat(id,"&SST=True");

$("#stage").append(url);
$.ajaxSetup({
  headers : {
"accountKey":"ZbYb7MbXREWqZP7RDI6dbg==",
'accept': 'application/json'
  }
});
    
$.getJSON(url, function(bus) { 
alert("success");
x+="<p> Bus Stop ID : "+id+'</p><br>';
$("#stage").append(x);
$("#stage").append(bus);
x+= '  <div class="table-responsive"> <table class="table"><thead><tr><th>Bus Number</th><th> 1st bus </th><th> 2nd bus </th><th> 3rd bus </th></tr></thead><tbody>'
;
for (i in bus.Services) {
var a=bus.Services[i].NextBus.EstimatedArrival;
var b=bus.Services[i].SubsequentBus.EstimatedArrival;
var c=bus.Services[i].SubsequentBus3.EstimatedArrival;
var ahours=(new Date(a)).getHours();
var amins=(new Date(a)).getMinutes();
var bhours=(new Date(b)).getHours();
var bmins=(new Date(b)).getMinutes();
var chours=(new Date(c)).getHours();
var cmins=(new Date(c)).getMinutes();
var bus1time = Math.floor(((new Date(a)).getTime() - (new Date(d)).getTime())/60000);
var bus2time= Math.floor(((new Date(b)).getTime() - (new Date(d)).getTime())/60000);
var bus3time= Math.floor(((new Date(c)).getTime() - (new Date(d)).getTime())/60000);
var aload=bus.Services[i].NextBus.Load;
var bload=bus.Services[i].SubsequentBus.Load;
var cload=bus.Services[i].SubsequentBus3.Load;

    x += '<tr><td><h3>Bus ' + bus.Services[i].ServiceNo + '</h3></td><td>' ;
    x += bus1time + " mins <br>"  + ahours +":"+ amins+"<br>"+aload+'</td><td>';    
    x += bus2time + " mins <br>"  + bhours +":"+ bmins+"<br>"+bload+'</td><td>';  
    x += bus3time + " mins <br>"  + chours +":"+ cmins+"<br>"+cload+'</td></tr>';   

};
x+="</tbody></table></div>"
;
$("#stage").html(x);
x="";
});
}); 
});
</script>
</head>
<body>
<div class="container">
<form>
  <select class="form-control" name="BusStopID" id="BusStopNumber">
<option selected>Choose your bus stop</option>
    <option value="66061">BCA Academy</option>
    <option value="66069">Comfort Delgro</option>
    <option value="52059">Blk 219</option>
    <option value="52051">Blk 147</option>
    <option value="80279">Mountbatten MRT</option>    
  </select>
</form>
      <p id = "stage">hello</p>
</div>

<footer role="contentinfo">
 <div id="footer" class="container">
<center>

 <p>Designed and built by ngxingyu &copy; </p> 
<br>
</center>
 </div>
</footer>

      
      
      
</body>

</html>